---

name: Check that all translatable message are extracted from source code

description: >2
  Given the checkout repository, run the frontend translation message extraction and
  fail if there are changes.

  Developers should ensure that localization messages are updated/extracted as part of
  the pull request (without actually translating), and any possible compilation results
  kept in version control must be in sync.

  The action sets up node using the .nvmrc file in the repository. No checkout is
  performed automatically - you must set this up yourself.

inputs:
  messages-path:
    type: string
    required: false
    description: >
      Path containing the messages for each locale.
    default: 'i18n/messages'

  locales:
    type: string
    required: false
    description: >
      Comma-separated list of locales to check.
    default: 'nl'

runs:
  using: composite

  steps:
    - uses: astral-sh/setup-uv@v6
      # only run the check in release branches and for release tags
      if: startsWith(github.head_ref, 'release/') || startsWith(github.ref, 'refs/tags/')
      with:
        python-version: '3.12'

    - name: Find untranslated messages
      # only run the check in release branches and for release tags
      if: startsWith(github.head_ref, 'release/') || startsWith(github.ref, 'refs/tags/')
      run: |
        uv run "${{ github.action_path }}/find_untranslated_messages.py" \
          --messages "${{ inputs.messages-path }}" \
          --locales "${{ inputs.locales }}"
      shell: bash
